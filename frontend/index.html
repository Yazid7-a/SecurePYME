<div id="auth-container" style="max-width: 400px; margin: auto; padding: 20px; background: white; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); text-align: center; margin-bottom: 30px;">
  
  <img src="https://upload.wikimedia.org/wikipedia/commons/b/b5/Lock-icon.png" alt="Login Icon" width="50" style="margin-bottom: 20px;">

  <h2>Acceso a SecurePYME</h2>

  <!-- Login -->
  <input type="text" id="login-username" placeholder="Nombre de usuario" style="width: 100%; margin: 10px 0; padding: 10px; border: 1px solid #ccc; border-radius: 5px;">
  <input type="password" id="login-password" placeholder="Contrase√±a" style="width: 100%; margin: 10px 0; padding: 10px; border: 1px solid #ccc; border-radius: 5px;">
  <button onclick="login()" style="width: 100%; padding: 10px; background-color: #007bff; color: white; border: none; border-radius: 5px; margin-bottom: 10px;">Iniciar Sesi√≥n</button>

  <hr style="margin: 20px 0;">

  <!-- Registro -->
  <input type="text" id="register-username" placeholder="Nuevo nombre de usuario" style="width: 100%; margin: 10px 0; padding: 10px; border: 1px solid #ccc; border-radius: 5px;">
  <input type="password" id="register-password" placeholder="Nueva contrase√±a" style="width: 100%; margin: 10px 0; padding: 10px; border: 1px solid #ccc; border-radius: 5px;">
  <button onclick="registrar()" style="width: 100%; padding: 10px; background-color: #28a745; color: white; border: none; border-radius: 5px; margin-bottom: 10px;">Crear Cuenta</button>

  <!-- Cerrar sesi√≥n -->
  <button onclick="cerrarSesion()" style="display:none; width: 100%; padding: 10px; background-color: #dc3545; color: white; border: none; border-radius: 5px; margin-top: 10px;" id="cerrar-sesion-btn">Cerrar Sesi√≥n</button>

  <div id="mensaje-login" style="margin-top: 15px; font-weight: bold;"></div>
</div>

<!-- üí° SCRIPT para login y registro AL FINAL -->
<script>
  async function login() {
    const username = document.getElementById("login-username").value.trim();
    const password = document.getElementById("login-password").value.trim();
    const mensajeLogin = document.getElementById("mensaje-login");

    if (username === "" || password === "") {
      alert("Por favor, completa todos los campos.");
      return;
    }

    try {
      const res = await fetch('http://127.0.0.1:8000/login/', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username, password })
      });

      const data = await res.json();

      if (res.ok) {
        localStorage.setItem("usuario", username);
        mensajeLogin.innerText = `‚úÖ Bienvenido, ${username}`;
        mensajeLogin.style.color = "green";
        document.getElementById("cerrar-sesion-btn").style.display = "block";
        document.getElementById("login-username").style.display = "none";
        document.getElementById("login-password").style.display = "none";
      } else {
        mensajeLogin.innerText = `‚ùå Error: ${data.detail}`;
        mensajeLogin.style.color = "red";
      }

    } catch (err) {
      mensajeLogin.innerText = "‚ùå Error al conectar con el servidor.";
      mensajeLogin.style.color = "red";
    }
  }

  async function registrar() {
    const username = document.getElementById("register-username").value.trim();
    const password = document.getElementById("register-password").value.trim();
    const mensajeLogin = document.getElementById("mensaje-login");

    if (username === "" || password === "") {
      alert("Por favor, completa todos los campos de registro.");
      return;
    }

    try {
      const res = await fetch('http://127.0.0.1:8000/register/', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username, password })
      });

      const data = await res.json();

      if (res.ok) {
        mensajeLogin.innerText = `‚úÖ Usuario registrado correctamente: ${username}`;
        mensajeLogin.style.color = "green";
      } else {
        mensajeLogin.innerText = `‚ùå Error al registrar: ${data.detail}`;
        mensajeLogin.style.color = "red";
      }

    } catch (err) {
      mensajeLogin.innerText = "‚ùå Error al conectar con el servidor.";
      mensajeLogin.style.color = "red";
    }
  }

  function cerrarSesion() {
    localStorage.removeItem("usuario");
    location.reload(); // Recargamos la p√°gina para limpiar todo
  }
</script>
